function drawLine(a,b,c,d,e){e.selectAll(a).append("line").attr("x1",b).attr("x2",b).attr("y1",0).attr("y2",c).attr("class","data "+d)}function drawRect(a,b,c,d,e,f){f.selectAll(a).append("rect").attr("x",c).attr("width",b).attr("height",d).attr("class","data "+e)}function getTimeIntervalArray(a,b){var c=[];return c.push(a.navigationStart+" ms"),b&&c.push(a.redirectStart+"~"+a.redirectEnd+" ms"),c.push(a.fetchStart+" ms"),c.push(a.domainLookupStart+"~"+a.domainLookupEnd+" ms"),c.push(a.connectStart+"~"+a.connectEnd+" ms"),c.push(a.requestStart+" ms"),c.push(a.responseStart+"~"+a.responseEnd+" ms"),c.push(a.domLoading+" ms"),c.push(a.domInteractive+" ms"),c.push(a.domContentLoadedEventStart+"~"+a.domContentLoadedEventEnd+" ms"),c.push(a.domComplete+" ms"),c.push(a.loadEventStart+"~"+a.loadEventEnd+" ms"),c}function getTimeSliceArray(a,b){var c=[];return c.push("0 ms"),b&&c.push(a.redirectEnd-a.redirectStart+" ms"),c.push("0 ms"),c.push(a.domainLookupEnd-a.domainLookupStart+" ms"),c.push(a.connectEnd-a.connectStart+" ms"),c.push("0 ms"),c.push(a.responseEnd-a.responseStart+" ms"),c.push("0 ms"),c.push("0 ms"),c.push(a.domContentLoadedEventEnd-a.domContentLoadedEventStart+" ms"),c.push("0 ms"),c.push(a.loadEventEnd-a.loadEventStart+" ms"),c}function paint(a){var b=!0;a.redirectStart&&0!=a.redirectStart||(b=!1);var c=a.navigationStart;for(var d in a)a[d]=a[d]-c;var e=a.loadEventEnd-a.navigationStart,f=["navigationStart","redirect","fetchStart","domainLookup","connect","requestStart","response","domLoading","domInteractive","domContentLoaded","domComplete","loadEvent"];b||(f=["navigationStart","fetchStart","domainLookup","connect","requestStart","response","domLoading","domInteractive","domContentLoaded","domComplete","loadEvent"]);var g=[a.navigationStart,a.fetchStart,a.domainLookupStart,a.domainLookupEnd,a.connectStart,a.connectEnd],h=Math.min.apply(Math,g),i=Math.max.apply(Math,g),j=i-h,k=h,l=[a.requestStart,a.responseStart,a.responseEnd],m=Math.min.apply(Math,l),n=Math.max.apply(Math,l),o=n-m,p=m,q=[a.domLoading,a.domInteractive,a.domContentLoadedEventStart,a.domContentLoadedEventEnd,a.loadEventStart,a.loadEventEnd,a.domComplete],r=Math.min.apply(Math,q),s=Math.max.apply(Math,q),t=s-r,u=r,v=600,w=360,x=20,y=d3.scale.linear().domain([0,e]).range([0,w]),z=d3.selectAll(".chart g").remove(),z=d3.select(".chart").attr("width",v).attr("height",x*f.length),A=z.selectAll("g").data(f).enter().append("g").attr("transform",function(a,b){return"translate(0,"+b*x+")"});b?A.attr("class",function(a,b){return b>=0&&2>b?"n n"+(b+1):b>=2&&5>b?"n f f"+(b-1):b>=5&&7>b?"r r"+(b-4):b>=7&&12>b?"d d"+(b-6):void 0}):A.attr("class",function(a,b){return b>=0&&1>b?"n n"+(b+1):b>=1&&4>b?"n f f"+b:b>=4&&6>b?"r r"+(b-3):b>=6&&11>b?"d d"+(b-5):void 0}),A.append("rect").attr("width",w).attr("height",x-1).attr("class","background"),A.append("text").attr("x",w+3).attr("y",x/2).attr("dy",".35em").text(function(a){return a});var B=z.selectAll("g.n");B.append("rect").attr("x",y(k)).attr("width",y(j)).attr("height",x-2).attr("class","step network_background");var C=z.selectAll("g.r");C.append("rect").attr("x",y(p)).attr("width",y(o)).attr("height",x-2).attr("class","step request_background");var D=z.selectAll("g.d");D.append("rect").attr("x",y(u)).attr("width",y(t)).attr("height",x-2).attr("class","step dom_background");var E=0;drawLine("g.n1",y(a.navigationStart),x-2,"network_data",z),b&&(E=a.redirectEnd-a.redirectStart,y(E)<1?drawLine("g.n2",y(a.redirectEnd),x-2,"network_data",z):drawRect("g.n2",y(E),y(a.redirectStart),x-2,"network_data",z)),drawLine("g.f1",y(a.fetchStart),x-2,"network_data",z),E=a.domainLookupEnd-a.domainLookupStart,y(E)<1?drawLine("g.f2",y(a.domainLookupEnd),x-2,"network_data",z):drawRect("g.f2",y(E),y(a.domainLookupStart),x-2,"network_data",z),E=a.connectEnd-a.connectStart,y(E)<1?drawLine("g.f3",y(a.connectEnd),x-2,"network_data",z):drawRect("g.f3",y(E),y(a.connectStart),x-2,"network_data",z),drawLine("g.r1",y(a.requestStart),x-2,"request_data",z),E=a.responseEnd-a.responseStart,y(E)<1?drawLine("g.r2",y(a.responseEnd),x-2,"request_data",z):drawRect("g.r2",y(E),y(a.responseStart),x-2,"request_data",z),drawLine("g.d1",y(a.domLoading),x-2,"dom_data",z),drawLine("g.d2",y(a.domInteractive),x-2,"dom_data",z),E=a.domContentLoadedEventEnd-a.domContentLoadedEventStart,y(E)<1?drawLine("g.d3",y(a.domContentLoadedEventEnd),x-2,"dom_data",z):drawRect("g.d3",y(E),y(a.domContentLoadedEventStart),x-2,"dom_data",z),drawLine("g.d4",y(a.domComplete),x-2,"dom_data",z),E=a.loadEventEnd-a.loadEventStart,y(E)<1?drawLine("g.d5",y(a.loadEventEnd),x-2,"dom_data",z):drawRect("g.d5",y(E),y(a.loadEventStart),x-2,"dom_data",z);var F=getTimeIntervalArray(a,b);z.selectAll("g").data(F).append("text").attr("x",w+120+3).attr("y",x/2).attr("dy",".35em").text(function(a){return a});var G=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),H=getTimeSliceArray(a,b);z.selectAll(".step").data(H).on("mouseover",function(a){G.transition().duration(200).style("opacity",.9).style("z-index",3),G.html(a).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){G.transition().duration(500).style("opacity",0)}),z.selectAll(".data").data(H).on("mouseover",function(a){G.transition().duration(200).style("opacity",.9).style("z-index",3),G.html(a).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){G.transition().duration(500).style("opacity",0)})}